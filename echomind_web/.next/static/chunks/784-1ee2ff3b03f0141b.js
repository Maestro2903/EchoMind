"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[784],{1784:function(e,t,s){s.d(t,{ud:function(){return j},lx:function(){return D},tm:function(){return N},SO:function(){return v},Oo:function(){return L},Yz:function(){return C},T3:function(){return T},Rx:function(){return Z},et:function(){return F},kS:function(){return M},ks:function(){return b},lS:function(){return A},ps:function(){return k},sZ:function(){return x},Lj:function(){return O}});var a=s(1694),r=s(5978);class i{static async createUser(e,t){let s=(0,r.JU)(a.RZ,"users",e);await (0,r.pl)(s,{...t,createdAt:(0,r.Bt)()})}static async getUser(e){let t=(0,r.JU)(a.RZ,"users",e),s=await (0,r.QT)(t);return s.exists()?s.data():null}static async updateUser(e,t){let s=(0,r.JU)(a.RZ,"users",e);await (0,r.r7)(s,t)}static async deleteUser(e){let t=(0,r.qs)(a.RZ),s=(0,r.hJ)(a.RZ,"users",e,"sessions");for(let i of(await (0,r.PL)(s)).docs){let s=i.id,n=(0,r.hJ)(a.RZ,"users",e,"sessions",s,"transcripts");(await (0,r.PL)(n)).docs.forEach(e=>t.delete(e.ref));let o=(0,r.hJ)(a.RZ,"users",e,"sessions",s,"aiMessages");(await (0,r.PL)(o)).docs.forEach(e=>t.delete(e.ref));let c=(0,r.JU)(a.RZ,"users",e,"sessions",s,"summary","data");t.delete(c),t.delete(i.ref)}let i=(0,r.hJ)(a.RZ,"users",e,"promptPresets");(await (0,r.PL)(i)).docs.forEach(e=>t.delete(e.ref));let n=(0,r.JU)(a.RZ,"users",e);t.delete(n),await t.commit()}}class n{static async createSession(e,t){let s=(0,r.hJ)(a.RZ,"users",e,"sessions");return(await (0,r.ET)(s,{...t,startedAt:(0,r.Bt)()})).id}static async getSession(e,t){let s=(0,r.JU)(a.RZ,"users",e,"sessions",t),i=await (0,r.QT)(s);return i.exists()?i.data():null}static async getSessions(e){let t=(0,r.hJ)(a.RZ,"users",e,"sessions"),s=(0,r.IO)(t,(0,r.Xo)("startedAt","desc"));return(await (0,r.PL)(s)).docs.map(e=>({id:e.id,...e.data()}))}static async updateSession(e,t,s){let i=(0,r.JU)(a.RZ,"users",e,"sessions",t);await (0,r.r7)(i,s)}static async deleteSession(e,t){let s=(0,r.qs)(a.RZ),i=(0,r.hJ)(a.RZ,"users",e,"sessions",t,"transcripts");(await (0,r.PL)(i)).docs.forEach(e=>s.delete(e.ref));let n=(0,r.hJ)(a.RZ,"users",e,"sessions",t,"aiMessages");(await (0,r.PL)(n)).docs.forEach(e=>s.delete(e.ref));let o=(0,r.JU)(a.RZ,"users",e,"sessions",t,"summary","data");s.delete(o);let c=(0,r.JU)(a.RZ,"users",e,"sessions",t);s.delete(c),await s.commit()}}class o{static async addTranscript(e,t,s){let i=(0,r.hJ)(a.RZ,"users",e,"sessions",t,"transcripts");return(await (0,r.ET)(i,{...s,createdAt:(0,r.Bt)()})).id}static async getTranscripts(e,t){let s=(0,r.hJ)(a.RZ,"users",e,"sessions",t,"transcripts"),i=(0,r.IO)(s,(0,r.Xo)("startAt","asc"));return(await (0,r.PL)(i)).docs.map(e=>({id:e.id,...e.data()}))}}class c{static async addAiMessage(e,t,s){let i=(0,r.hJ)(a.RZ,"users",e,"sessions",t,"aiMessages");return(await (0,r.ET)(i,{...s,createdAt:(0,r.Bt)()})).id}static async getAiMessages(e,t){let s=(0,r.hJ)(a.RZ,"users",e,"sessions",t,"aiMessages"),i=(0,r.IO)(s,(0,r.Xo)("sentAt","asc"));return(await (0,r.PL)(i)).docs.map(e=>({id:e.id,...e.data()}))}}class l{static async setSummary(e,t,s){let i=(0,r.JU)(a.RZ,"users",e,"sessions",t,"summary","data");await (0,r.pl)(i,s)}static async getSummary(e,t){let s=(0,r.JU)(a.RZ,"users",e,"sessions",t,"summary","data"),i=await (0,r.QT)(s);return i.exists()?i.data():null}}class d{static async createPreset(e,t){let s=(0,r.hJ)(a.RZ,"users",e,"promptPresets");return(await (0,r.ET)(s,{...t,createdAt:(0,r.Bt)()})).id}static async getPresets(e){let t=(0,r.hJ)(a.RZ,"users",e,"promptPresets"),s=(0,r.IO)(t,(0,r.Xo)("createdAt","desc"));return(await (0,r.PL)(s)).docs.map(e=>({id:e.id,...e.data()}))}static async updatePreset(e,t,s){let i=(0,r.JU)(a.RZ,"users",e,"promptPresets",t);await (0,r.r7)(i,s)}static async deletePreset(e,t){let s=(0,r.JU)(a.RZ,"users",e,"promptPresets",t);await (0,r.oe)(s)}}let u=()=>!1,p=e=>1e3*e.seconds+Math.floor(e.nanoseconds/1e6),f=(e,t)=>({id:e.id,uid:t,title:e.title,session_type:e.session_type,started_at:p(e.startedAt),ended_at:e.endedAt?p(e.endedAt):void 0,sync_state:"clean",updated_at:p(e.startedAt)}),m=e=>({id:e.id,session_id:"",start_at:p(e.startAt),end_at:e.endAt?p(e.endAt):void 0,speaker:e.speaker,text:e.text,lang:e.lang,created_at:p(e.createdAt),sync_state:"clean"}),y=e=>({id:e.id,session_id:"",sent_at:p(e.sentAt),role:e.role,content:e.content,tokens:e.tokens,model:e.model,created_at:p(e.createdAt),sync_state:"clean"}),w=(e,t)=>({session_id:t,generated_at:p(e.generatedAt),model:e.model,text:e.text,tldr:e.tldr,bullet_json:JSON.stringify(e.bulletPoints),action_json:JSON.stringify(e.actionItems),tokens_used:e.tokensUsed,updated_at:p(e.generatedAt),sync_state:"clean"}),h=(e,t)=>({id:e.id,uid:t,title:e.title,prompt:e.prompt,is_default:e.isDefault?1:0,created_at:p(e.createdAt),sync_state:"clean"}),g="",U=async()=>{try{let e=await fetch("/runtime-config.json");if(e.ok){let t=await e.json();return console.log("✅ Runtime config loaded:",t),t.API_URL}}catch(e){console.log("⚠️ Failed to load runtime config:",e)}return null},_=!1,E=null,S=async()=>{if(_)return;let e=await U();if(e){g=e,_=!0;return}console.log("\uD83D\uDCCD Using fallback API URL:",g),_=!0};E=S();let I=[],J=()=>{let e=localStorage.getItem("echomind_user");if(e)try{return JSON.parse(e)}catch(e){console.error("Failed to parse user info:",e),localStorage.removeItem("echomind_user")}return null},k=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e?localStorage.setItem("echomind_user",JSON.stringify(e)):localStorage.removeItem("echomind_user"),t||(I.forEach(t=>t(e)),window.dispatchEvent(new Event("userInfoChanged")))},P=()=>{let e={"Content-Type":"application/json"},t=J();return(null==t?void 0:t.uid)&&(e["X-User-ID"]=t.uid),e},R=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!_&&E&&await E,_||await S();let s="".concat(g).concat(e);return console.log("\uD83C\uDF10 apiCall (Local Mode):",{path:e,API_ORIGIN:g,fullUrl:s,initialized:_,timestamp:new Date().toISOString()}),fetch(s,{headers:{"Content-Type":"application/json",...P(),...t.headers||{}},...t})},A=async e=>{if(!e.trim())return[];if(u())return(await Z()).filter(t=>t.title.toLowerCase().includes(e.toLowerCase()));{let t=await R("/api/conversations/search?q=".concat(encodeURIComponent(e)),{method:"GET"});if(!t.ok)throw Error("Failed to search conversations");return t.json()}},Z=async()=>{if(u()){let e=a.I8.currentUser.uid;return(await n.getSessions(e)).map(t=>f(t,e))}{let e=await R("/api/conversations",{method:"GET"});if(!e.ok)throw Error("Failed to fetch sessions");return e.json()}},T=async e=>{if(u()){let t=a.I8.currentUser.uid,[s,r,i,d]=await Promise.all([n.getSession(t,e),o.getTranscripts(t,e),c.getAiMessages(t,e),l.getSummary(t,e)]);if(!s)throw Error("Session not found");return{session:f({id:e,...s},t),transcripts:r.map(t=>({...m(t),session_id:e})),ai_messages:i.map(t=>({...y(t),session_id:e})),summary:d?w(d,e):null}}{let t=await R("/api/conversations/".concat(e),{method:"GET"});if(!t.ok)throw Error("Failed to fetch session details");return t.json()}},v=async e=>{if(u()){let t=a.I8.currentUser.uid;await n.deleteSession(t,e)}else if(!(await R("/api/conversations/".concat(e),{method:"DELETE"})).ok)throw Error("Failed to delete session")},F=async()=>{if(u()){let e=a.I8.currentUser,t=await i.getUser(e.uid);return{uid:e.uid,display_name:(null==t?void 0:t.displayName)||e.displayName||"User",email:(null==t?void 0:t.email)||e.email||"no-email@example.com"}}{let e=await R("/api/user/profile",{method:"GET"});if(!e.ok)throw Error("Failed to fetch user profile");return e.json()}},O=async e=>{if(u()){let t=a.I8.currentUser.uid;await i.updateUser(t,{displayName:e.displayName})}else if(!(await R("/api/user/profile",{method:"PUT",body:JSON.stringify(e)})).ok)throw Error("Failed to update user profile")},L=async e=>{if(u()){let t=a.I8.currentUser.uid;return await i.getUser(t)||await i.createUser(t,{displayName:e.display_name,email:e.email}),e}{let t=await R("/api/user/find-or-create",{method:"POST",body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to find or create user");return t.json()}},b=async e=>{if(u()){console.log("API key is not needed in Firebase mode");return}if(!(await R("/api/user/api-key",{method:"POST",body:JSON.stringify({apiKey:e})})).ok)throw Error("Failed to save API key")},j=async()=>{if(u())return{hasApiKey:!0};{let e=await R("/api/user/api-key-status",{method:"GET"});if(!e.ok)throw Error("Failed to check API key status");return e.json()}},N=async()=>{if(u()){let e=a.I8.currentUser.uid;await i.deleteUser(e),await a.I8.currentUser.delete()}else if(!(await R("/api/user/profile",{method:"DELETE"})).ok)throw Error("Failed to delete account")},C=async()=>{if(u()){let e=a.I8.currentUser.uid;return(await d.getPresets(e)).map(t=>h(t,e))}{let e=await R("/api/presets",{method:"GET"});if(!e.ok)throw Error("Failed to fetch presets");return e.json()}},D=async e=>{if(u()){let t=a.I8.currentUser.uid;return{id:await d.createPreset(t,{title:e.title,prompt:e.prompt,isDefault:!1})}}{let t=await R("/api/presets",{method:"POST",body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to create preset");return t.json()}},x=async(e,t)=>{if(u()){let s=a.I8.currentUser.uid;await d.updatePreset(s,e,{title:t.title,prompt:t.prompt})}else{let s=await R("/api/presets/".concat(e),{method:"PUT",body:JSON.stringify(t)});if(!s.ok){let e=await s.text();throw Error("Failed to update preset: ".concat(s.status," ").concat(e))}}},M=async()=>{if(u()){let{signOut:e}=await Promise.resolve().then(s.bind(s,3301));await e(a.I8)}k(null),localStorage.removeItem("openai_api_key"),localStorage.removeItem("user_info"),window.location.href="/login"}},1694:function(e,t,s){s.d(t,{I8:function(){return o},RZ:function(){return c}});var a=s(738),r=s(3301),i=s(5978);let n=(0,a.C6)().length?(0,a.Mq)():(0,a.ZF)({apiKey:"AIzaSyAgtJrmsFWG1C7m9S55HyT1laICEzuUS2g",authDomain:"echomind-3651a.firebaseapp.com",projectId:"echomind-3651a",storageBucket:"echomind-3651a.firebasestorage.app",messagingSenderId:"904706892885",appId:"1:904706892885:web:0e42b3dda796674ead20dc",measurementId:"G-SQ0WM6S28T"}),o=(0,r.v0)(n),c=(0,i.ad)(n)}}]);